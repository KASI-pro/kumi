<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <!-- Latest compiled and minified CSS -->
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
<style>
.sendButton{
  font-size:0.75em;
  display:block;
  width:100px;
  padding-top:10px;
  padding-bottom:10px;
  text-align:center;
  margin:0 auto;
  border:2px solid;
  border-color:#99FFFF #33FFFF #33FFFF #99FFFF;
  background:#66FFFF;
}
#sendFrom {
  margin: 15px auto;
  width: 100%;
  height: 100px;
  border: solid 1px black;
  background-color: #ddd;
  line-height: 100px;
  text-align: center;
}
.nontext{
  border:none;
  width:130px;
  background:white;
}
.required::after {
  content: "必須";
  background-color: #f0ad4e;
  color: #fff;
  font-size: 12px;
  font-weight: bold;
  min-width: 10px;
  padding: 3px 7px;
  margin: 0px 5px;
  line-height: 1;
  vertical-align: middle;
  white-space: nowrap;
  text-align: center;
  border-radius: 10px;
  display: inline-block;
}
</style>
</head>
<body>
  <div class="container">
    <div class="navbar">
      <h1>組声フォーム</h1>
    </div>
    <form id="content" name="content">
     <div class="form-row">
      <label class="col-sm-3 col-form-label">①回答：</label>
       <div class="col-sm-9">
        <p>
          <select class="custom-select w-25" id="answer" autocomplete="①answer">
              <option value="0">要</option>
              <option value="1" selected>不要</option>
          </select>
	  <span><input type="text" class="nontext" disabled></span>
          <span><button type="reset" class="btn btn-info">リセット</button></span>
        </p>
       </div>
      </div>
     <div class="form-row">
      <label class="col-sm-3 col-form-label">②支所：</label>
       <div class="col-sm-9">
        <p>
          <select class="custom-select w-50"  id="branch" name="branch">
		<option value="101">枚方支所</option>
		<option value="102">南寝屋川支所</option>
		<option value="103">南寝屋川個配センター</option>
		<option value="104">南枚方支所</option>
		<option value="105">北枚方支所</option>
		<option value="106">寝屋川支所</option>
		<option value="107">門真支所</option>
		<option value="301">港支所</option>
		<option value="302">西成支所</option>
		<option value="303">港個配センター</option>
		<option value="304">生野支所</option>
		<option value="305">南津守支所</option>
		<option value="307">平野支所</option>
		<option value="401">鶴見支所</option>
		<option value="402">都島個配センター</option>
		<option value="405">都島支所</option>
          </select>
        </p>
       </div>
      </div>
      <div class="form-row">
        <label class="col-sm-3 col-form-label required">③コースコード：</label>
        <div class="col-sm-9">
          <p>
            <input type="tel" id="kcode" class="form-control" maxlength='4' placeholder="コースコード">
          </p>
        </div>
      </div>
        <div class="form-row">
        <label class="col-sm-3 col-form-label required">④組合員コード：</label>
		
        <div class="col-sm-9">
          <p>
            <input type="tel" id="kmcode" class="form-control" maxlength='8' placeholder="組合員コード">
          </p>
        </div>
	  <div>
		<p>＜対応＞<br>
			<label><input type="radio" name="corres" value="0" checked><span style="margin-right: 8em;">通常</span></label>
			<label><input type="radio" name="corres" value="00000000"><span style="margin-right: 8em;">匿名</span></label>
			<label><input type="radio" name="corres" value="99999999"><span style="margin-right: 8em;">地域の声</span></label>
		</p>
	  </div>	
      </div>
　　　<div class="form-row">
        <label class="col-sm-3 col-form-label">⑤企画回：</label>
        <div class="col-sm-9">
          <p>
            <input type="tel" id="kikakai" class="form-control" maxlength='7' placeholder="企画回">
          </p>
        </div>
      </div>
      <div class="form-row">
        <label class="col-sm-3 col-form-label">⑥商品番号：</label>
        <div class="col-sm-9">
          <p>
            <input type="tel" id="pcode" class="form-control" maxlength='6' placeholder="商品番号">
          </p>
        </div>
      </div>
       <div class="form-row">
        <label class="col-sm-3 col-form-label required">⑦商品名：</label>
        <div class="col-sm-9">
          <p>
            <input type="text" id="pname" class="form-control" placeholder="商品名">
          </p>
        </div>
      </div>
     <div class="form-row">
        <label class="col-sm-3 col-form-label required">⑧お申し出内容：</label>
        <div class="col-sm-9">
          <p>
              <textarea type="textarea" id="offer" rows="4" cols="34" placeholder="お申し出内容"></textarea>
          </p>
        </div>
      </div>
        <div class="form-row">
        <label class="col-sm-3 col-form-label">⑨担当者のコメント：</label>
        <div class="col-sm-9">
          <p>
              <textarea type="textarea" id="comment" rows="4" cols="34" placeholder="担当者のコメント"></textarea>
          </p>
        </div>
      </div>
	<input type="button" id="sendFrom" value="メール送信"><br><br>
    </form>
  </div>
</body>
 <script>
window.onload=function(){
	var param = location.search;
	document.getElementById("branch").value = param;
	var f=document.getElementById("content");
	var reparam = param.replace('?', '');
	checkSelect(f.elements["branch"],reparam);
}
function checkSelect(obj,val){
	for(var i=0;i<obj.length;i++){
		if(obj[i].value==val){
			obj[i].selected=true;
			break;
		}
	 }
}
function mailOver() {
	var btn = document.getElementById("sendFrom");
	btn.addEventListener("touchstart", function(e) {
		let str1= document.getElementById("kcode").value;
			if(str1.length !== 4){
				alert("コースコードは4文字です")
			}else{
				let str2= document.getElementById("kmcode").value;
					if(str2.length !==8){
						alert("組合員コードは8文字です")
					}else{
						let str5= document.getElementById("offer").value;
							if(str5.length==0){
								alert("内容は必須です\nお書きください")
							}else{
								let str3= document.getElementById("kikakai").value;
								if(str3.length !== 0){
									if(str3.length !== 7){
										alert("\n 企画回は7文字必要です。\n\n 例：2021年11月1回 → 2021111")
									}else{
										var elements = document.getElementsByName('corres');
										var len = elements.length;
										var checkValue = '';
										for (let i = 0; i < len; i++){
											if (elements.item(i).checked){
												checkValue = elements.item(i).value;
											}
										}
										txtData = document.content;
										answer = txtData[0].value;
										branch = txtData[3].value;
										kcode = txtData[4].value;
										kmcode = txtData[5].value;
										kikakai = txtData[9].value;
										pcode = txtData[10].value;
										pname = txtData[11].value;
										offer = txtData[12].value;
										comment = txtData[13].value;
										address = 'tos_oka2@palcoop.or.jp';
										subject = '組合員の声';
										body = '{"body":{"answer":"'+answer+
												'","branch":"'+branch+
												'","kcode":"'+kcode+
												'","kmcode":"'+kmcode+
												'","corres":"'+checkValue+
												'","kikakai":"'+kikakai+
												'","pcode":"'+pcode+
												'","pname":"'+pname+
												'","offer":"'+offer+
												'","comment":"'+comment+
												'"}}';
									location.href = 'mailto:' + address + '?subject=' + subject + '&body=' + body;
									}
								}else{
									var elements = document.getElementsByName('corres');
									var len = elements.length;
									var checkValue = '';
									for (let i = 0; i < len; i++){
										if (elements.item(i).checked){
											checkValue = elements.item(i).value;
										}
									}
									txtData = document.content;
									answer = txtData[0].value;
									branch = txtData[3].value;
									kcode = txtData[4].value;
									kmcode = txtData[5].value;
									kikakai = txtData[9].value;
									pcode = txtData[10].value;
									pname = txtData[11].value;
									offer = txtData[12].value;
									comment = txtData[13].value;
									address = 'tos_oka2@palcoop.or.jp';
									subject = '組合員の声';
									body = '{"body":{"answer":"'+answer+
											'","branch":"'+branch+
											'","kcode":"'+kcode+
											'","kmcode":"'+kmcode+
											'","corres":"'+checkValue+
											'","kikakai":"'+kikakai+
											'","pcode":"'+pcode+
											'","pname":"'+pname+
											'","offer":"'+offer+
											'","comment":"'+comment+
											'"}}';
								location.href = 'mailto:' + address + '?subject=' + subject + '&body=' + body;
								}
				   			}
					}
			}
	}, false);
}
document.addEventListener("DOMContentLoaded", mailOver);
</script>
</html>
